<form #polypRecordingForm="ngForm" ngNativeValidate>

  <div class="form-group row">
    <div class="col-lg-2 col-md-4 col-sm-5 col-xs-5">
      <label for="polyp-name" class="required">Polyp</label>
    </div>
    <div class="col-lg-8 col-md-6 col-sm-6 col-xs-5">
      <div class="select">
        <select id="polyp-name" [(ngModel)]="selectedPolyp" name="selectedPolyp" required #polyp="ngModel">
          <option *ngFor="let p of polyps" [ngValue]="p">{{p.name}}</option>
        </select>
      </div>
    </div>
    <div class="col-lg-2 col-md-2 col-sm-1 col-xs-2">
      <button type="button" class="btn btn-icon" title="Add polyp" (click)="modalOpened = true">
        <clr-icon shape="plus"></clr-icon>
      </button>
    </div>
  </div>

  <div class="form-group row">
    <div class="col-lg-2 col-md-4 col-sm-5 col-xs-5">
      <label for="polyp-start" class="required">Start</label>
    </div>
    <div class="col-lg-8 col-md-6 col-sm-6 col-xs-5">
      <input id="polyp-start" type="text" name="start" [(ngModel)]="start" class="input-timer"
             required #startP="ngModel"/>
    </div>
    <div class="col-xs-2 col-sm-1 col-md-2">
      <button type="button" (click)="startInterval()" class="btn btn-icon">
        <clr-icon shape="clock"></clr-icon>
      </button>
    </div>
  </div>

  <div class="form-group row">
    <div class="col-lg-2 col-md-4 col-sm-5 col-xs-5">
      <label for="polyp-end" class="required">Stop</label>
    </div>
    <div class="col-lg-8 col-md-6 col-sm-6 col-xs-5">
      <input id="polyp-end" type="text" name="end" [(ngModel)]="end" class="input-timer" required
             #endP="ngModel"/>

    </div>
    <div class="col-xs-2 col-sm-1 col-md-2">
      <button type="button" (click)="endInterval()" class="btn btn-icon">
        <clr-icon shape="clock"></clr-icon>
      </button>
    </div>
  </div>

  <button type="submit" class="btn btn-primary"
          [disabled]="!timesAreCorrect() || polyp.invalid || startP.invalid || endP.invalid"
          (click)="addPolypRecording()">
    <clr-icon shape="plus"></clr-icon>
    Add
  </button>
</form>

<form #newPolypForm="ngForm" (submit)="addPolyp(); namePolyp.control.markAsPristine()" ngNativeValidate>
  <clr-modal [(clrModalOpen)]="modalOpened" [clrModalSize]="'sm'">
    <h3 class="modal-title">Add polyp</h3>
    <div class="modal-body">
      <div class="form-control">
        <label for="polyp-form-name" class="required">Name</label>
        <input type="text" id="polyp-form-name" [(ngModel)]="newPolyp.name" name="name" required
               pattern="[a-zA-ZñÑ0-9_\s\(\)-]+" title="Must be a alphanumeric" #namePolyp="ngModel"
        />
        <div *ngIf="namePolyp.errors && !namePolyp.pristine" class="alert alert-danger">
          <div *ngIf="namePolyp.errors.required">Name is required.</div>
          <div *ngIf="namePolyp.errors.pattern">Name can only contain letters, numbers or underscore.</div>
        </div>
        <div *ngIf="nameIsUsed()" class="alert alert-danger">This name is already being used</div>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-primary" type="submit" [disabled]="nameIsUsed() || namePolyp.invalid">
        <clr-icon shape="plus"></clr-icon>
        Add
      </button>
    </div>
  </clr-modal>
</form>
<div class="polyprecordings-container">
  <clr-datagrid>
    <clr-dg-column [clrDgField]="'polyp.name'" [clrDgSortOrder]="ascSort">Polyp</clr-dg-column>
    <clr-dg-column [clrDgField]="'start'">Start</clr-dg-column>
    <clr-dg-column [clrDgField]="'end'">Stop</clr-dg-column>
    <clr-dg-column>Actions</clr-dg-column>

    <clr-dg-row *clrDgItems="let polypRecording of video.polypRecording">
      <clr-dg-cell>{{polypRecording.polyp.name}}</clr-dg-cell>
      <clr-dg-cell>{{polypRecording.start | time}}</clr-dg-cell>
      <clr-dg-cell>{{polypRecording.end | time}}</clr-dg-cell>
      <clr-dg-cell>
        <button type="button" class="btn btn-success-outline"
                (click)="playInterval(polypRecording.start, polypRecording.end)">
          <clr-icon shape="play"></clr-icon>
          Play
        </button>
        <button type="button" class="btn btn-danger-outline" (click)="remove(polypRecording)">
          <clr-icon shape="times"></clr-icon>
          Remove
        </button>
      </clr-dg-cell>
    </clr-dg-row>

    <clr-dg-footer>{{video.polypRecording.length}} polyp recording</clr-dg-footer>
  </clr-datagrid>

</div>

<!-- Delete confirmation modal -->
<app-delete-confirmation *ngIf="deletingPolypRecording" [modelName]="'polyp recording'" [id]="polypRecording"
                         [name]="polypRecording.polyp.name"
                         [cancel]="cancel.bind(this)" [delete]="removePolypRecording.bind(this)">
</app-delete-confirmation>
