<!--
  ~  PIBA Frontend
  ~
  ~ Copyright (C) 2018-2020 - Miguel Reboiro-Jato,
  ~ Daniel Glez-Peña, Alba Nogueira Rodríguez, Florentino Fdez-Riverola,
  ~ Rubén Domínguez Carbajales, Jesús Miguel Herrero Rivas,
  ~ Eloy Sánchez Hernández, Laura Rivas Moral,
  ~ Manuel Puga Jiménez de Azcárate, Joaquín Cubiella Fernández,
  ~ Hugo López-Fernández, Silvia Rodríguez Iglesias, Fernando Campos Tato.
  ~
  ~  This program is free software: you can redistribute it and/or modify
  ~  it under the terms of the GNU General Public License as published by
  ~  the Free Software Foundation, either version 3 of the License, or
  ~  (at your option) any later version.
  ~
  ~  This program is distributed in the hope that it will be useful,
  ~  but WITHOUT ANY WARRANTY; without even the implied warranty of
  ~  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
  ~  GNU General Public License for more details.
  ~
  ~  You should have received a copy of the GNU General Public License
  ~  along with this program. If not, see <http://www.gnu.org/licenses/>.
  -->

<span class="spinner" *ngIf="isLoading()">
    Loading...
</span>

<div *ngIf="!isLoading()">
  <div class="clr-row clr-justify-content-end">
    <button class="btn btn-primary" routerLink="/polypdatasets/{{datasetId}}">Back</button>
  </div>

  <div class="clr-row">
    <div class="clr-col-1 clr-align-self-center" align="center">
      <button class="btn btn-link" [class.disabled]="!hasPrevious()" (click)="onGoToPrevious()">
        <i class="arrow-left"></i>
      </button>
    </div>
    <div class="clr-col-10">
      <div align="center">
        <span class="spinner" [hidden]="isVideoReady()">
          Loading...
        </span>
        <app-video [video]="polypRecording.video" [interval]="polypRecording" limitToInterval="true"
                   [intervalBoundaries]="intervalBoundaries" [highlightZones]="highlightZones" [hidden]="!isVideoReady()"
                   (ready)="onReady()" (snapshot)="onSnapshot($event)">
        </app-video>
      </div>
    </div>
    <div class="clr-col-1 clr-align-self-center" align="center">
      <button class="btn btn-link" [class.disabled]="!hasNext()" (click)="onGoToNext()">
        <i class="arrow-right"></i>
      </button>
    </div>
  </div>
</div>

<div class="card card-size" *ngIf="!isLoading()">
  <div class="card-header">Polyp recording info</div>
  <div class="clr-row margin-row">
    <div class="col-lg-2 col-sm-3 col-xs-4">
      Exploration
    </div>
    <div class="col-lg-4 col-sm-3 col-xs-8">
      <a routerLink="/explorations/{{polypRecording.polyp.exploration.id}}">
        {{polypRecording.polyp.exploration.title}}
      </a>
    </div>
    <div class="col-lg-2 col-sm-3 col-xs-4">
      Start
    </div>
    <div class="col-lg-4 col-sm-3 col-xs-8">
      {{polypRecording.start | time}}
    </div>
  </div>
  <div class="clr-row margin-row">
    <div class="col-lg-2 col-sm-3 col-xs-4">
      Polyp
    </div>
    <div class="col-lg-4 col-sm-3 col-xs-8">
      {{polypRecording.polyp.name}}
    </div>
    <div class="col-lg-2 col-sm-3 col-xs-4">
      End time
    </div>
    <div class="col-lg-4 col-sm-3 col-xs-8">
      {{polypRecording.end | time}}
    </div>
  </div>
  <div class="clr-row margin-row">
    <div class="col-lg-2 col-sm-3 col-xs-4">
      Video
    </div>
    <div class="col-lg-4 col-sm-3 col-xs-8">
      {{polypRecording.video.title}}
    </div>
    <div class="col-lg-2 col-sm-3 col-xs-4">
      Duration
    </div>
    <div class="col-lg-4 col-sm-3 col-xs-8">
      {{duration | time}}
    </div>
  </div>
  <div class="clr-row margin-row">
    <div class="col-lg-2 col-sm-3 col-xs-4">
      Snapshots gallery
    </div>
    <div class="col-lg-4 col-sm-3 col-xs-8" *ngIf="dataset.defaultGallery">
      dataset.defaultGallery.title
    </div>
    <div class="col-lg-4 col-sm-3 col-xs-8" *ngIf="!dataset.defaultGallery">
      <clr-alert clrAlertType="danger" [clrAlertClosable]="false" clrAlertSizeSmall="true">
        <clr-alert-item>
          <span class="alert-text">None assigned</span>
        </clr-alert-item>
      </clr-alert>
    </div>
  </div>
  <hr *ngIf="hasModifications()"/>
  <div class="clr-row margin-row" *ngIf="hasModifications()">
    <div class="col-lg-2 col-sm-3 col-xs-4">
      Modifications
    </div>
    <div class="col-lg-2 col-sm-2 col-xs-4">
      Start
    </div>
    <div class="col-lg-2 col-sm-2 col-xs-4">
      End
    </div>
    <div class="col-lg-2 col-sm-2 col-xs-4">
      Duration
    </div>
  </div>
  <div class="clr-row margin-row" *ngFor="let modification of modifications">
    <div class="col-lg-2 col-sm-3 col-xs-4">
      {{modification.modifier.name}}
    </div>
    <div class="col-lg-2 col-sm-2 col-xs-4">
      {{modification.start | time}}
    </div>
    <div class="col-lg-2 col-sm-2 col-xs-4">
      {{modification.end | time}}
    </div>
    <div class="col-lg-2 col-sm-2 col-xs-4">
      {{calculateModificationDuration(modification) | time}}
    </div>
  </div>
</div>

<canvas #canvas id="canvas" class="snapshot-canvas"></canvas>

<app-locate-polyp-in-image-dialog [(open)]="showSnapshotDialog"
  [src]="snapshotDataUrl" title="Locate and save snapshot"
  [disabled]="!hasGallery()" disabledMessage="A gallery must be selected to store image."
  (close)="onLocatePolypClose($event)">
</app-locate-polyp-in-image-dialog>
