<!--
  ~  PIBA Frontend
  ~
  ~ Copyright (C) 2018-2020 - Miguel Reboiro-Jato,
  ~ Daniel Glez-Peña, Alba Nogueira Rodríguez, Florentino Fdez-Riverola,
  ~ Rubén Domínguez Carbajales, Jesús Miguel Herrero Rivas,
  ~ Eloy Sánchez Hernández, Laura Rivas Moral,
  ~ Manuel Puga Jiménez de Azcárate, Joaquín Cubiella Fernández,
  ~ Hugo López-Fernández, Silvia Rodríguez Iglesias, Fernando Campos Tato.
  ~
  ~  This program is free software: you can redistribute it and/or modify
  ~  it under the terms of the GNU General Public License as published by
  ~  the Free Software Foundation, either version 3 of the License, or
  ~  (at your option) any later version.
  ~
  ~  This program is distributed in the hope that it will be useful,
  ~  but WITHOUT ANY WARRANTY; without even the implied warranty of
  ~  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
  ~  GNU General Public License for more details.
  ~
  ~  You should have received a copy of the GNU General Public License
  ~  along with this program. If not, see <http://www.gnu.org/licenses/>.
  -->

<span class="spinner" *ngIf="isLoadingInitialData">
    Loading...
</span>

<div [hidden]="isLoadingInitialData">
  <div class="clr-row clr-justify-content-end">
    <a class="btn btn-success" [download]="fileName" [href]="imageAnnotator.dataUrl">
      Download
    </a>
    <button class="btn btn-primary" (click)="onNavigateToGallery()">
      Back
    </button>
  </div>
  <div class="clr-row">
    <div class="clr-col-1 clr-align-self-center" align="center">
      <button class="btn btn-link" [disabled]="!canGoToPreviousImage()" (click)="onNavigateToPrevious()">
        <i class="arrow-left"></i>
      </button>
    </div>
    <div class="clr-col-10">
      <div align="center">
        <app-image-annotator #imageAnnotator [src]="imageUrl" [(polypLocation)]="polypLocation"
                             [disabled]="!canLocatePolyp()" [showLocation]="showPolypLocation">
        </app-image-annotator>
      </div>
    </div>
    <div class="clr-col-1 clr-align-self-center" align="center">
      <button class="btn btn-link" [disabled]="!canGoToNextImage()" (click)="onNavigateToNext()">
        <i class="arrow-right"></i>
      </button>
    </div>
  </div>

  <div class="clr-row clr-justify-content-end polyp-checkbox" id="show-location-checkbox">
    <clr-checkbox [(clrChecked)]="showPolypLocation">
      Show polyp location
    </clr-checkbox>
  </div>
  <div *ngIf="isEndoscopist()" class="clr-row clr-justify-content-center">
    <button *ngIf="hasPolyp()" class="btn btn-success" (click)="onSave()" [disabled]="!canSaveLocation()">
      <clr-icon shape="plus"></clr-icon>
      Save (s)
    </button>
    <button *ngIf="hasPolyp()" class="btn btn-primary" (click)="onClear()" [disabled]="!canClearLocation()">
      <clr-icon shape="refresh"></clr-icon>
      Clear
    </button>
    <button class="btn btn-danger btn-remove" (click)="onTriggerDeletion()" [disabled]="!canRemoveImage()">
      <clr-icon shape="trash"></clr-icon>
      Remove image
    </button>
  </div>
  <div *ngIf="isEndoscopist() && !hasPolyp()" class="clr-row clr-justify-content-center">
    <div class="alert alert-danger">
      <div class="alert-item static">
        <div class="alert-icon-wrapper">
          <clr-icon class="alert-icon" shape="exclamation-triangle"></clr-icon>
        </div>
        <span class="alert-text">Image does not have a polyp!</span>
      </div>
    </div>
  </div>

  <div *ngIf="hasImageObservation()" class="card card-size">
      <div class="margin-row">{{image.observation}}</div>
  </div>

  <div *ngIf="hasPolyp() && !isEndoscopist()" class="card card-size">
    <div class="card-header">Polyp info</div>
      <div class="clr-row margin-row">
        <div class="col-lg-2 col-sm-3 col-xs-4">
          <label class="txt-strong" for="polyp-name">Name</label>
        </div>
        <div class="col-lg-4 col-sm-3 col-xs-8">
          <input type="text" id="polyp-name" readonly value="{{image.polyp.name}}"/>
        </div>
        <div class="col-lg-2 col-sm-3 col-xs-4">
          <label class="txt-strong" for="polyp-size">Size (mm)</label>
        </div>
        <div class="col-lg-4 col-sm-3 col-xs-8">
          <input type="text" id="polyp-size" readonly value="{{image.polyp.size}}"/>
        </div>
      </div>
      <div class="clr-row margin-row">
        <div class="col-lg-2 col-sm-3 col-xs-4">
          <label class="txt-strong" for="polyp-location">Location</label>
        </div>
        <div class="col-lg-4 col-sm-3 col-xs-8">
          <input type="text" id="polyp-location" readonly value="{{image.polyp.location}}"/>
        </div>
        <div class="col-lg-2 col-sm-3 col-xs-4">
          <label class="txt-strong" for="polyp-nice">NICE</label>
        </div>
        <div class="col-lg-4 col-sm-3 col-xs-8">
          <input type="text" id="polyp-nice" readonly value="{{image.polyp.nice}}"/>
        </div>
      </div>
      <div class="clr-row margin-row">
        <div class="col-lg-2 col-sm-3 col-xs-4">
          <label class="txt-strong" for="polyp-wasp">WASP</label>
        </div>
        <div class="col-lg-4 col-sm-3 col-xs-8">
          <input type="text" id="polyp-wasp" readonly value="{{image.polyp.wasp}}"/>
        </div>
        <div class="col-lg-2 col-sm-3 col-xs-4">
          <label class="txt-strong" for="polyp-lst">LST</label>
        </div>
        <div class="col-lg-4 col-sm-3 col-xs-8">
          <input type="text" id="polyp-lst" readonly value="{{image.polyp.lst}}"/>
        </div>
      </div>
      <div class="clr-row margin-row">
        <div class="col-lg-2 col-sm-3 col-xs-4">
          <label class="txt-strong" for="polyp-parisPrimary">PARIS</label>
        </div>
        <div class="col-lg-4 col-sm-3 col-xs-8">
          <input type="text" id="polyp-parisPrimary" readonly value="{{image.polyp.parisPrimary}}"/>
        </div>
        <div class="col-lg-2 col-sm-3 col-xs-4" *ngIf="image.polyp.parisSecondary !== undefined">
          <label class="txt-strong" for="polyp-parisSecondary">PARIS Secondary</label>
        </div>
        <div class="col-lg-4 col-sm-3 col-xs-8" *ngIf="image.polyp.parisSecondary !== undefined">
          <input type="text" id="polyp-parisSecondary" readonly value="{{image.polyp.parisSecondary}}"/>
        </div>
      </div>
      <div class="clr-row margin-row">
        <div class="col-lg-2 col-sm-4 col-xs-4">
          <label class="txt-strong" for="polyp-histology">Histology</label>
        </div>
        <div class="col-lg-4 col-sm-8 col-xs-8">
          <input type="text" id="polyp-histology" readonly value="{{image.polyp.histology.polypType}}"/>
        </div>
      </div>
      <div class="clr-row margin-row" *ngIf="type || dysplasingGrade">
        <div class="col-lg-2 col-sm-4 col-xs-4" *ngIf="type">
          <label class="txt-strong" for="polyp-type">Type</label>
        </div>
        <div class="col-lg-4 col-sm-8 col-xs-8" *ngIf="type">
          <input type="text" id="polyp-type" readonly value="{{type}}"/>
        </div>
        <div class="col-lg-2 col-sm-4 col-xs-4" *ngIf="dysplasingGrade">
          <label class="txt-strong" for="polyp-dyplasingGrade">Dyplasing drade</label>
        </div>
        <div class="col-lg-4 col-sm-8 col-xs-8" *ngIf="dysplasingGrade">
          <input type="text" id="polyp-dyplasingGrade" readonly value="{{dysplasingGrade}}"/>
        </div>
      </div>
      <div class="clr-row margin-row">
        <div class="col-lg-2 col-sm-4 col-xs-4">
          <label class="txt-strong" for="manually-selected">Manually selected</label>
        </div>
        <div class="col-lg-4 col-sm-8 col-xs-8">
          <input type="text" id="manually-selected" readonly value="{{image.manuallySelected ? 'Yes' : 'No' }}"/>
        </div>
      </div>

      <div class="clr-row margin-row">
        <div class="col-xs-12">
          <label class="txt-strong" for="polyp-observation">Observation</label>
        </div>
        <div class="col-xs-12">
          <input type="text" id="polyp-observation" readonly value="{{image.polyp.observation}}"/>
        </div>
      </div>
  </div>

  <app-continue-without-saving-location-dialog
    [(open)]="showContinueWithoutSavingLocation" (close)="onContinueWithoutSavingClose($event)">
  </app-continue-without-saving-location-dialog>

  <app-confirm-removing-location-dialog
    [(open)]="showConfirmRemovingLocation" (close)="onConfirmRemovingLocationClose($event)">
  </app-confirm-removing-location-dialog>

  <app-delete-confirmation [(open)]="showDeleteConfirmation" [id]="image.id" [modelName]="'image'"
                           [name]="'this image'" (confirm)="onDeleteConfirmed()" (cancel)="onDeleteCancelled()">
  </app-delete-confirmation>

  <app-describe-polyp-deletion-dialog [(open)]="showDescribePolypDeletionReason"
                                      (close)="onDescribePolypDeletionReason($event)">
  </app-describe-polyp-deletion-dialog>
</div>





